<doctype html>
<html lang='en'>
<head>
	<meta charset='utf-8'>
	<meta name='viewport' content='width=device-width,initial-scale=1' />
	<title>Ind.ie Labs - Blog - Delay</title>
	<!--[if lte IE 8]>
    <script src='https://ind.ie/assets/js/html5shiv.js'></script>
  <![endif]-->
  <link rel='shortcut icon' href='/favicon.ico'>
  <link rel='apple-touch-icon' href='https://ind.ie/assets/images/ios-180.png'>
  <link rel='apple-touch-icon' sizes='76x76' href='https://ind.ie/assets/images/ios-76.png'>
  <link rel='apple-touch-icon' sizes='120x120' href='https://ind.ie/assets/images/ios-120.png'>
  <link rel='apple-touch-icon' sizes='152x152' href='https://ind.ie/assets/images/ios-152.png'>
  <link rel='apple-touch-icon' sizes='152x152' href='https://ind.ie/assets/images/ios-180.png'>
	<link rel='alternate' type='application/rss+xml' title='Ind.ie Labs Blog' href='https://ind.ie/labs/blog/rss/index.xml' />
	<link rel='stylesheet' href='/assets/css/lab-styles.css'/>
	<link rel="stylesheet" href="../css/highlight/kimbie.dark.css">
	<link rel='stylesheet' href='../css/styles.css'/>
	<script src="../js/highlight.pack.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>
</head>
<body class='labs labs-blog'>
	<!-- @import '../../../../assets/includes/_nav.kit' -->
	<div class='main h-entry'>
        <!-- @import '../../../../includes/_archive-notice.kit' -->
		<h1 class='p-name long-title'>Delay</h1>
		<p class='post-date dt-published' datetime='2015-04-18 07:00:00'>18th April, 2015 — <span class='p-author'>Aral Balkan</span></p>
		<div class='e-content'>

		<figure>
			<img src='images/time-goes-by-janet-ramsden.jpg' style='width:100%;' alt='Long-exposure of a clockface'/>
			<figcaption>Timing is everything (or at least very important) in crafting experiences.<br><small>Photo courtesy <a href='https://www.flickr.com/photos/ramsd/5933053057/in/photolist-a3hrYe-cMgbim-7XvgBb-5FaoF-7UTmVK-4EUabQ-NNUB4-5tMZp4-9fj4Wd-9vJDWb-5YUXDj-j9GAJ-b3wBMV-8pWyxR-4y3Rug-73vP4i-bxZqpK-5NdMnS-7fiJ73-6Qcp9N-6o8iJd-bvwWwp-x5k4W-aFdwoN-dordUa-8XXBFV-iACTVC-eDcUR-apCzE2-64a3tt-5pvYk-3cyW4k-Rc1BX-9SW2uq-7dAyAY-q9yT2J-2VSbT-pFpbmv-9WuNhs-aiprfD-54kXb2-ndxHdu-nYxGQM-f1mc4X-xBLcG-8odcnD-esubhQ-e2Y72r-b4HU86-93FUX3'>Janet Ramsden</a></figcaption>
		</figure>

		<h2>Now, wait just a minute…</h2>

		<p>When you’re creating a user interface, the ability to easily control when things happen is important. One issue you’ll run into quite quickly (I remember this from my Flash days) is that there will be times when you need to do something on the next stack frame (the next pass of the event/run loop). Node.js, for example, has <code>process.nextTick()</code>, or you can use <code>setTimeout(timeoutHandler, 0)</code>. If you use the latter — less efficient — technique, you can delay execution not just to the next stack frame but by any number of seconds.</p> 
		<p>Having a simple, expressive way to delay execution is something that will make your development life easier and it’s great when troubleshooting UI issues.</p>

		<p>In Cocoa, we can use either NSTimer or Grand Central Dispatch for this. Neither method is optimised for authoring, however, so I put together a very simple library called Delay based on <a href='https://github.com/katleta3000/CancelBlocks'>the work of Evgenii Rtishchev</a> and <a href='http://stackoverflow.com/questions/24034544/dispatch-after-gcd-in-swift/24318861#24318861'>Chris Brind</a> (with thanks to Cezary Wojcik for <a href='http://stackoverflow.com/a/24034838/253485'>the link to Chris’s work</a>.)</p>

		<h2>Code</h2>

		<p>Grab the code from our Git repository: <a href='https://source.ind.ie/project/delay/tree/master'>source.ind.ie/project/delay</a></p>

		<h2>Usage</h2>

		<h3>Execute on next stack frame</h3>

		<pre>Swift: <code>delay(0.0)
{
  // Do something.
}</code></pre>

		<p>(Note: you can also use <code><a href='https://github.com/duemunk/Async'>dispatch_async</a></code> for this and, like <code>nextTick()</code> in Node, it’s meant to be more efficient.</p>

		<h3>Execute after an arbitrary number of seconds</h3>

		<pre>Swift: <code>delay(42.0)
{
  // Do something.
}</code></pre>

		<h3>Cancel before execution</h3>

		<pre>Swift: <code>let cancellableCommand = delay(42.0)
{
  // Do something.
}

cancellableCommand.cancel()
</code></pre>

		<h3>Throttling</h3>

		<p>Being able to cancel execution is especially important when you want to react to throttle user input. For example, when auto-saving text entry, you don’t want to carry out an expensive write operation on every keystroke but perhaps save the text half a second after the user stops typing. (You can use the same pattern for implementing features like auto completion.)</p>

		<p>So, you can do, for example:</p>

		<pre>Swift: <code>var textDidChangeHandler:NotificationHandler?
var cancellableAutoCompleteCommand:CancellableDelayedCommand?

// …

override func viewWillAppear()
{
  textDidChangeHandler = handle(NSControlTextDidChangeNotification, from: myTextInput)
  {
    /* as */ notification in
        
    let text = self.myTextInput.stringValue
        
    // Throttle auto-complete lookups to every 1/3rd of a second.
    cancellableAutoCompleteCommand = cancellableAutoCompleteCommand?.reset() ?? delay(0.3)
    {
      // Perform expensive operation: look-up text for auto-complete
      // …
    }
  }	
}

override func viewWillDisappear()
{
  cancellableAutoCompleteCommand?.cancel()
  textDidChangeHandler?.remove()
}</code></pre>

		<p>(For notification handling in the example above, I’m using the <a href='../handle/'>Handle micro-library</a>).</p>

		</div>
		<div id="discourse-comments"></div>

<footer class="site-footer">
                <h2 class="site-name"><a href="https://ind.ie">ind.ie</a></h2>
                <small class="copyright"><abbr title="Copyright">©</abbr> <a href="/about/#trademarks">Article 12</a>. All content is <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International</a>, unless otherwise stated.</small>
                <div class="view-source-wrap">
                    <a class="view-source" href="https://source.ind.ie/project/ind-ie-site/tree/master">View source</a>
                </div>
            </footer>
	</div>
    <script type='text/javascript'>
      var discourseUrl = 'https://forum.ind.ie/',
          discourseEmbedUrl = 'https://ind.ie/labs/blog/delay/';

      (function() {
        var d = document.createElement('script'); d.type = 'text/javascript'; d.async = true;
          d.src = discourseUrl + 'javascripts/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(d);
            })();
    </script>
</body>
</html>