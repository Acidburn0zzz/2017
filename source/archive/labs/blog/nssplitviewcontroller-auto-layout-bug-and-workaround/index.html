<doctype html>
<html lang='en'>
<head>
	<meta charset='utf-8'>
	<meta name='viewport' content='width=device-width,initial-scale=1' />
	<title>Ind.ie Labs - Blog - NSSplitViewController Auto Layout Bug and Workaround</title>
	<!--[if lte IE 8]>
        <script src='https://ind.ie/assets/js/html5shiv.js'></script>
    <![endif]-->
    <link rel='shortcut icon' href='/favicon.ico'>
    <link rel='apple-touch-icon' href='https://ind.ie/assets/images/ios-180.png'>
    <link rel='apple-touch-icon' sizes='76x76' href='https://ind.ie/assets/images/ios-76.png'>
    <link rel='apple-touch-icon' sizes='120x120' href='https://ind.ie/assets/images/ios-120.png'>
    <link rel='apple-touch-icon' sizes='152x152' href='https://ind.ie/assets/images/ios-152.png'>
    <link rel='apple-touch-icon' sizes='152x152' href='https://ind.ie/assets/images/ios-180.png'>
	<link rel='alternate' type='application/rss+xml' title='Ind.ie Labs Blog' href='https://ind.ie/labs/blog/rss/index.xml' />
	<link rel='stylesheet' href='/assets/css/lab-styles.css'/>
	<link rel="stylesheet" href="../css/highlight/kimbie.dark.css">
	<link rel='stylesheet' href='../css/styles.css'/>
	<script src="../js/highlight.pack.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>
</head>
<body class='labs labs-blog'>
	<!-- @import '../../../../assets/includes/_nav.kit' -->
	<div class='main h-entry'>
        <!-- @import '../../../../includes/_archive-notice.kit' -->
		<h1 class='p-name long-title'>NSSplitViewController Auto Layout Bug and Workaround</h1>
		<p class='post-date dt-published' datetime='2015-01-30 11:30:00'>31st March, 2015 — <span class='p-author'>Aral Balkan</span></p>
		<div class='e-content'>

		<figure>
			<img src='images/xcode-screenshot.png' style='' alt='Screenshot of the example project.'/>
			<figcaption>Setting one of the two split view items in an NSSplitViewController as collapsed in Interface Builder can cause a runtime constraints error.</figcaption>
		</figure>

		<h2>You can’t constrain this!</h2>

		<p>NSSplitViewController has an edge-case Auto Layout bug that manifests when a split view item is set as collapsed in Interface Builder (IB) and then shown at some point after <code>viewDidLoad</code> (e.g., in response to a user action).</p>

		<p>It actually took me two days to track down this little rascal so I took the time to create a simple isolated example that replicates the issue.</p>

		<p><a href='downloads/Test.zip'>Download the source here.</a> <small><em>(Test.zip, 68KB)</em></small></p>

		<p>The exception thrown by the sample is below:</p>

		<pre>Error console output:<code>2015-03-31 13:46:32.669 Test[7890:1234827] Unable to simultaneously satisfy constraints:
(
    "&lt;NSLayoutConstraint:0x6080000850a0 H:[_NSSplitViewItemViewWrapper:0x6000001411e0(50)]&gt;",
    "&lt;NSLayoutConstraint:0x6000000879e0 H:|-(0)-[NSView:0x6000001221c0]   (Names: '|':_NSSplitViewItemViewWrapper:0x6000001411e0 )&gt;",
    "&lt;NSLayoutConstraint:0x600000087a30 H:[NSView:0x6000001221c0]-(0)-|   (Names: '|':_NSSplitViewItemViewWrapper:0x6000001411e0 )&gt;",
    "&lt;NSLayoutConstraint:0x600000087620 H:[NSBox:0x10052d0a0'Box'(560)]&gt;",
    "&lt;NSLayoutConstraint:0x600000087760 H:|-(20)-[NSBox:0x10052d0a0'Box']   (Names: '|':NSView:0x6000001221c0 )&gt;",
    "&lt;NSLayoutConstraint:0x6000000877b0 H:[NSBox:0x10052d0a0'Box']-(20)-|   (Names: '|':NSView:0x6000001221c0 )&gt;"
)

Will attempt to recover by breaking constraint 
&lt;NSLayoutConstraint:0x600000087620 H:[NSBox:0x10052d0a0'Box'(560)]&gt;

Set the NSUserDefault NSConstraintBasedLayoutVisualizeMutuallyExclusiveConstraints to YES to have -[NSWindow visualizeConstraints:] automatically called when this happens.  And/or, break on objc_exception_throw to catch this in the debugger.
</code></pre>

		<p>As far as I can tell, the problem appears to be this: When Cocoa sees a collapsed split view item, it automatically creates a width constraint with required priority on the also-automatically-created <code>_NSSplitViewItemViewWrapper</code>. Then, if your split view item’s view also has a required width constraint of some sort, they conflict when you set <code>collapsed = false</code> later on.</p>
		
		<h2>Workaround</h2>

		<p>The isolated example I’ve provided should hopefully make it easy for Apple to fix this but, in the meanwhile, there is an easy workaround: Either,</p>

		<ul>
			<li>Leave the <em>Collapsed</em> checkbox unchecked in IB and set the split view item’s <code>collapsed</code> property to true in the <code>viewDidLoad</code> method of your <code>NSSplitViewController</code> subclass.</li>
			<li>Check the <em>Collapsed</em> checkbox in IB and then, in your <code>NSSplitViewController</code> subclass’s <code>viewDidLoad</code> method do:

			<pre>Swift: <code>mySplitViewItem.collapsed = false
mySplitViewItem.collapsed = true
			</code></pre>

			Simply setting the <code>collapsed</code> property to <code>false</code> momentarily and then setting it to <code>true</code> is enough, even though it happens on the same stack frame. I can only assume that doing so results in the width constraint of the view being measured and then correctly and applied to the <code>_NSSplitViewItemViewWrapper</code>’s width constraint.
			</li>
		</ul>

		<p>I hope this helps you work around the problem and makes it easier for the folks at Apple to fix it. (<a href='rdar://20432741'>rdar://20432741</a>)</p>

		</div>
		<div id="discourse-comments"></div>

		<footer class="site-footer">
                <h2 class="site-name"><a href="https://ind.ie">ind.ie</a></h2>
                <small class="copyright"><abbr title="Copyright">©</abbr> <a href="/about/#trademarks">Article 12</a>. All content is <a href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International</a>, unless otherwise stated.</small>
                <div class="view-source-wrap">
                    <a class="view-source" href="https://source.ind.ie/project/ind-ie-site/tree/master">View source</a>
                </div>
            </footer>
	</div>
    <script type='text/javascript'>
      var discourseUrl = 'https://forum.ind.ie/',
          discourseEmbedUrl = 'https://ind.ie/labs/blog/nssplitviewcontroller-auto-layout-bug-and-workaround/';

      (function() {
        var d = document.createElement('script'); d.type = 'text/javascript'; d.async = true;
          d.src = discourseUrl + 'javascripts/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(d);
            })();
    </script>
</body>
</html>